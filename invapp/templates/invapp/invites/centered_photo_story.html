{% extends "invapp/base_invite.html" %}
{% load static %}
{% load i18n %}

{% block page_specific_fonts %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
{% endblock %}

{% block page_specific_styles %}
<style>
    body {
        background-color: #ffffff;
        color: #18181b;
        font-family: 'Montserrat', sans-serif;
    }
    .font-serif-display { font-family: 'Bodoni Moda', serif; }
    
    .photo-frame {
        position: relative;
        overflow: hidden;
        border-radius: 0.5rem;
    }
    
    .btn-minimal {
        background-color: #18181b;
        color: white;
        transition: all 0.3s ease;
    }
    .btn-minimal:hover {
        background-color: #3f3f46;
    }

    .reveal {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.8s ease-out;
    }
    .reveal.visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-screen-md mx-auto px-6 py-20 space-y-32">

    <!-- 1. Header / Intro -->
    <section class="text-center reveal visible">
        <h1 class="font-serif-display text-6xl md:text-8xl mb-8 leading-none tracking-tighter">
            {{ event.bride_name|default:"Maria" }} <br> & {{ event.groom_name|default:"Andrei" }}
        </h1>
        <p class="mt-8 text-lg uppercase tracking-widest text-zinc-500">{{ event.title|default:_("We are getting married") }} </p>
        <div class="mt-12 h-20 w-px bg-zinc-200 mx-auto"></div>
    </section>

    <!-- 2. Main Photo -->
    {% if event.couple_photo %}
    <section class="reveal">
        <div class="photo-frame aspect-[4/5] shadow-2xl">
            <img src="{{ event.couple_photo.url }}" alt="Couple" class="w-full h-full object-cover">
        </div>
    </section>
    {% endif %}

    <!-- 3. The Date & Wording -->
    <section class="text-center space-y-12 reveal">
        <div class="space-y-4">
            <p class="font-serif-display text-4xl italic">{{ event.event_date|date:"d . m . Y" }}</p>
            <p class="text-zinc-400 uppercase tracking-[0.3em] text-sm">{{ event.party_time|time:"H:i" }}</p>
        </div>
        
        <div class="max-w-md mx-auto">
            <p class="text-xl leading-relaxed font-light text-zinc-600">
                {{ event.invitation_wording|default:_("Two lives, two hearts joined together in friendship united forever in love.") }}
            </p>
        </div>
    </section>

    <!-- 4. Locations -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-12 reveal">
        <div class="space-y-6">
            <h2 class="font-serif-display text-3xl">{% translate "Ceremony" %}</h2>
            <div class="space-y-2 text-zinc-500">
                <p class="font-semibold text-zinc-800">{{ event.ceremony_location }}</p>
                <p>{{ event.ceremony_time|time:"H:i" }}</p>
            </div>
            {% if event.ceremony_maps_url %}
                <a href="{{ event.ceremony_maps_url }}" target="_blank" class="inline-block text-xs font-bold uppercase tracking-widest border-b-2 border-zinc-100 pb-1 hover:border-zinc-800 transition-all">
                    {% translate "View location" %}
                </a>
            {% endif %}
        </div>

        <div class="space-y-6">
            <h2 class="font-serif-display text-3xl">{% translate "Reception" %}</h2>
            <div class="space-y-2 text-zinc-500">
                <p class="font-semibold text-zinc-800">{{ event.venue_name }}</p>
                <p>{{ event.venue_address }}</p>
                <p>{{ event.party_time|time:"H:i" }}</p>
            </div>
            {% if event.party_maps_url %}
                <a href="{{ event.party_maps_url }}" target="_blank" class="inline-block text-xs font-bold uppercase tracking-widest border-b-2 border-zinc-100 pb-1 hover:border-zinc-800 transition-all">
                    {% translate "View location" %}
                </a>
            {% endif %}
        </div>
    </section>

    <!-- 5. Secondary Photo -->
    {% if event.landscape_photo %}
    <section class="reveal">
        <div class="photo-frame aspect-video shadow-xl">
            <img src="{{ event.landscape_photo.url }}" alt="Venue" class="w-full h-full object-cover">
        </div>
    </section>
    {% endif %}

    <!-- 6. RSVP -->
    {% if not is_preview %}
    <section id="rsvp" class="text-center reveal">
        <div class="max-w-md mx-auto">
            <h2 class="font-serif-display text-3xl text-zinc-800 mb-6">{% translate "Confirm Attendance" %}</h2>
            
            <form method="POST" action="{% url 'invapp:guest_invite' guest_uuid=guest.unique_id %}" class="space-y-8" id="rsvp-form">
                {% csrf_token %}
                
                <div class="flex justify-center gap-12 border-y border-zinc-100 py-8">
                    {% for radio in form.attending %}
                        <label class="flex items-center gap-3 cursor-pointer group">
                            {{ radio.tag }}
                            <span class="text-lg group-hover:text-zinc-500 transition-colors">{{ radio.choice_label }}</span>
                        </label>
                    {% endfor %}
                </div>

                <div id="attending_details" class="space-y-8 text-left" style="display: none;">
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest">{% translate "Guests" %}</label>
                        <input type="number" name="{{ form.number_attending.name }}" min="1" max="{{ guest.max_attendees }}" class="w-full border-b-2 border-zinc-100 focus:border-zinc-800 outline-none py-2 transition-all">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest">{% translate "Dietary Requirements" %}</label>
                        <textarea name="{{ form.meal_preference.name }}" rows="2" class="w-full border-b-2 border-zinc-100 focus:border-zinc-800 outline-none py-2 transition-all"></textarea>
                    </div>
                </div>

                <div class="text-left space-y-2">
                    <label class="text-xs font-bold uppercase tracking-widest">{% translate "Message" %}</label>
                    <textarea name="{{ form.message.name }}" rows="3" class="w-full border-b-2 border-zinc-100 focus:border-zinc-800 outline-none py-2 transition-all" placeholder="{% translate 'Your message...' %}"></textarea>
                </div>

                <button type="submit" class="btn-minimal w-full py-5 rounded-sm font-bold tracking-widest uppercase text-sm">
                    {% translate "Send Response" %}
                </button>
            </form>
        </div>
    </section>
    {% endif %}

    <footer class="text-center pt-20 text-zinc-300">
        <p class="font-serif-display italic text-2xl mb-4 text-zinc-400">InvApp</p>
        <p class="text-[10px] uppercase tracking-[0.5em]">Digital Invitations</p>
    </footer>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const revealElements = document.querySelectorAll('.reveal');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
        });
    }, { threshold: 0.1 });
    revealElements.forEach(el => observer.observe(el));

    const rsvpForm = document.getElementById('rsvp-form');
    if (rsvpForm) {
        const attendingRadios = document.querySelectorAll('input[name="attending"]');
        const attendingDetailsDiv = document.getElementById('attending_details');
        const attendingYesRadio = document.querySelector('input[name="attending"][value="True"]');

        function toggleDetails() {
            if (attendingDetailsDiv && attendingYesRadio) {
                attendingDetailsDiv.style.display = attendingYesRadio.checked ? 'block' : 'none';
            }
        }
        attendingRadios.forEach(r => r.addEventListener('change', toggleDetails));
        toggleDetails();

        rsvpForm.addEventListener('submit', function(e) {
            // Simplified check for already submitted
            {% if guest.is_attending is not None %}
                if (!confirm("{% translate 'You have already submitted an RSVP. Are you sure you want to change your response?' %}")) {
                    e.preventDefault();
                }
            {% endif %}
        });
    }
});
</script>
{% endblock %}
{% extends "invapp/base_invite.html" %}
{% load static %}
{% load i18n %}

{% block page_specific_fonts %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block page_specific_styles %}
<style>
    :root {
        --brand-blue: #A5D8FF;
        --brand-darkblue: #4DABF7;
        --brand-yellow: #FFF9DB;
        --brand-heading: #1971C2;
        --brand-text: #495057;
    }

    body {
        background-color: #f8f9fa;
        color: var(--brand-text);
        font-family: 'Quicksand', sans-serif;
    }

    .font-fredoka { font-family: 'Fredoka', sans-serif; }

    .duck-card {
        background: white;
        border-radius: 2rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        border: 4px solid var(--brand-blue);
    }

    .btn-duck {
        background-color: var(--brand-heading);
        color: white;
        border-radius: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-duck:hover {
        background-color: var(--brand-darkblue);
        transform: scale(1.05);
    }

    .duck-bg-pattern {
        background-image: radial-gradient(var(--brand-blue) 1px, transparent 1px);
        background-size: 20px 20px;
        opacity: 0.3;
    }
</style>
{% endblock %}

{% block content %}
<div class="relative min-h-screen py-12 px-4 overflow-hidden">
    <div class="fixed inset-0 duck-bg-pattern -z-10"></div>

    <!-- Decorative Ducks -->
    <div class="absolute top-10 left-5 w-16 opacity-40 rotate-12">
        <img src="{% static 'invapp/images/Duckling/Duck.png' %}" alt="duck">
    </div>
    <div class="absolute bottom-20 right-5 w-20 opacity-40 -rotate-12">
        <img src="{% static 'invapp/images/Duckling/Duck.png' %}" alt="duck">
    </div>

    <main class="max-w-xl mx-auto space-y-12">
        <!-- Hero Section -->
        <section class="text-center space-y-6">
            <div class="relative inline-block">
                <img src="{% static 'invapp/images/Duckling/GirlDucks.png' %}" alt="Baptism Duckling" class="w-48 mx-auto animate-bounce duration-[3000ms]">
            </div>
            <h1 class="font-fredoka text-4xl md:text-5xl text-brand-heading leading-tight">
                {% translate "Holy Baptism" %} <br>
                <span class="text-brand-darkblue">{{ event.child_name|default:"Baby Name" }}</span>
            </h1>
            <div class="inline-block px-6 py-2 bg-brand-blue rounded-full text-white font-bold tracking-wider">
                {{ event.event_date|date:"d . m . Y" }}
            </div>
        </section>

        <!-- Main Card -->
        <section class="duck-card p-8 md:p-12 text-center space-y-8 relative overflow-hidden">
            <div class="space-y-4">
                <p class="text-lg italic text-gray-500">
                    {% translate "together with the parents" %}
                </p>
                <p class="text-xl font-bold text-brand-heading">{{ event.parents_names }}</p>
                
                {% if event.godparents.all %}
                <div class="pt-4 space-y-2">
                    <p class="text-lg italic text-gray-500">{% translate "and the godparents" %}</p>
                    {% for gp in event.godparents.all %}
                        <p class="text-xl font-bold text-brand-heading">{{ gp.name }}</p>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="h-px w-24 bg-brand-blue mx-auto"></div>

            <div class="space-y-4 text-lg">
                <p>{{ event.invitation_wording|default:_("We joyfully invite you to the baptism that will take place on") }}</p>
                <div class="p-6 bg-brand-yellow/50 rounded-2xl border-2 border-dashed border-brand-blue/30">
                    <div class="space-y-4">
                        <div>
                            <p class="font-semibold text-brand-heading">{% translate "Religious Service" %}</p>
                            <p>{{ event.ceremony_time|time:"H:i" }}</p>
                            <p>{{ event.ceremony_location }}</p>
                            {% if event.ceremony_maps_url %}
                                <a href="{{ event.ceremony_maps_url }}" target="_blank" class="text-xs font-bold text-brand-darkblue uppercase tracking-widest hover:underline mt-2 inline-block">{% translate "View Map" %}</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <p class="font-semibold text-brand-heading">{% translate "We look forward to seeing you!" %}</p>
            </div>
        </section>

        <!-- Party Location -->
        <section class="duck-card p-8 md:p-12 text-center space-y-6">
            <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-glass-cheers text-2xl text-brand-darkblue"></i>
            </div>
            <h3 class="font-fredoka text-2xl font-semibold text-brand-heading mb-4">{% translate "Party Location" %}</h3>
            <div class="space-y-2">
                <p class="text-xl font-bold">{{ event.venue_name }}</p>
                <p class="text-gray-500">{{ event.venue_address }}</p>
                <p class="text-lg font-semibold text-brand-darkblue">{{ event.party_time|time:"H:i" }}</p>
            </div>
            {% if event.party_maps_url %}
                <a href="{{ event.party_maps_url }}" target="_blank" class="inline-flex items-center px-6 py-2 bg-brand-blue text-white rounded-full text-sm font-bold hover:bg-brand-darkblue transition-all">
                    <i class="fas fa-map-marker-alt mr-2"></i> {% translate "View Directions" %}
                </a>
            {% endif %}
        </section>

        <!-- RSVP Form -->
        {% if not is_preview %}
        <section id="rsvp" class="duck-card p-8 md:p-12">
            <h3 class="font-fredoka text-2xl font-semibold text-brand-heading mb-2 text-center">{% translate "Confirm Attendance" %}</h3>
            <p class="text-center mb-6">{% translate "Please confirm your presence." %}</p>

            <form method="POST" action="{% url 'invapp:guest_invite' guest_uuid=guest.unique_id %}" class="space-y-6">
                {% csrf_token %}
                
                <div class="p-4 bg-blue-50 rounded-xl mb-6">
                    <p class="text-center text-base">{% translate "Invitation for:" %} <strong class="font-semibold">{{ guest.name }}</strong></p>
                </div>

                <div class="flex justify-center gap-8 mb-8">
                    {% for radio in form.attending %}
                        <label class="flex flex-col items-center gap-2 cursor-pointer">
                            {{ radio.tag }}
                            <span class="font-semibold text-gray-600">{{ radio.choice_label }}</span>
                        </label>
                    {% endfor %}
                </div>

                <div id="attending_details" class="space-y-4" style="display: none;">
                    <div>
                        <label class="block text-sm font-semibold mb-2">{% translate "Number of Guests" %}</label>
                        <input type="number" name="{{ form.number_attending.name }}" min="1" max="{{ guest.max_attendees }}" class="w-full p-3 rounded-xl border-2 border-brand-blue/30 focus:border-brand-darkblue outline-none" placeholder="1">
                        <p class="text-[10px] text-gray-400 mt-1">Max: {{ guest.max_attendees }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">{% translate "Menu Preferences / Allergies" %}</label>
                        <textarea name="{{ form.meal_preference.name }}" rows="2" class="w-full p-3 rounded-xl border-2 border-brand-blue/30 focus:border-brand-darkblue outline-none"></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-2">{% translate "Message" %}</label>
                    <textarea name="{{ form.message.name }}" rows="2" class="w-full p-3 rounded-xl border-2 border-brand-blue/30 focus:border-brand-darkblue outline-none" placeholder="{% translate 'Your wishes...' %}"></textarea>
                </div>

                <button type="submit" class="btn-duck w-full py-4 text-lg">{% translate "Send Response" %}</button>
            </form>
        </section>
        {% endif %}

        <footer class="text-center pt-12 pb-8">
            <p class="text-brand-heading font-fredoka">InvApp Romania</p>
            <div class="flex justify-center gap-4 mt-4 text-brand-blue opacity-50">
                <i class="fas fa-baby"></i>
                <i class="fas fa-heart"></i>
                <i class="fas fa-star"></i>
            </div>
        </footer>
    </main>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const attendingRadios = document.querySelectorAll('input[name="attending"]');
    const attendingDetailsDiv = document.getElementById('attending_details');
    const attendingYesRadio = document.querySelector('input[name="attending"][value="True"]');

    function toggleDetails() {
        if (attendingDetailsDiv && attendingYesRadio) {
            attendingDetailsDiv.style.display = attendingYesRadio.checked ? 'block' : 'none';
        }
    }
    attendingRadios.forEach(r => r.addEventListener('change', toggleDetails));
    toggleDetails();
});
</script>
{% endblock %}
{% load i18n %}

<form method="post" class="space-y-6">
    {% csrf_token %}

    {# Render 'attending' field (RadioSelect) #}
    <div class="form-group">
        <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">{{ form.attending.label }}</label>
        <div class="flex flex-col space-y-2">
            {% for radio in form.attending %}
                <label class="flex items-center gap-3 p-3 rounded-xl border border-gray-100 dark:border-slate-800 hover:bg-gray-50 dark:hover:bg-slate-800/50 cursor-pointer transition-colors">
                    {{ radio.tag }}
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-200">{{ radio.choice_label }}</span>
                </label>
            {% endfor %}
        </div>
        {% if form.attending.errors %}<p class="mt-1 text-xs text-red-500 font-bold uppercase tracking-wider">{{ form.attending.errors|striptags }}</p>{% endif %}
    </div>

    {# Fields to hide/show #}
    <div id="attending_details" style="display: none;" class="space-y-6 pt-4 border-t border-gray-50 dark:border-slate-800/50">
        <div class="form-group">
            <label for="{{ form.number_attending.id_for_label }}" class="block text-xs font-black uppercase tracking-widest text-gray-400 mb-2">{{ form.number_attending.label }}</label>
            {{ form.number_attending }}
            {% if form.number_attending.errors %}<p class="mt-1 text-xs text-red-500 font-bold uppercase tracking-wider">{{ form.number_attending.errors|striptags }}</p>{% endif %}
            <p class="mt-2 text-[10px] text-gray-400 font-medium italic">
                {% blocktranslate with max=guest.max_attendees %}(Up to {{ max }} allowed for your invitation){% endblocktranslate %}
            </p>
        </div>

        <div class="form-group">
            <label for="{{ form.meal_preference.id_for_label }}" class="block text-xs font-black uppercase tracking-widest text-gray-400 mb-2">{{ form.meal_preference.label }}</label>
            {{ form.meal_preference }}
            {% if form.meal_preference.errors %}<p class="mt-1 text-xs text-red-500 font-bold uppercase tracking-wider">{{ form.meal_preference.errors|striptags }}</p>{% endif %}
        </div>
    </div>

    {# Render 'message' field #}
    <div class="form-group pt-4 border-t border-gray-50 dark:border-slate-800/50">
        <label for="{{ form.message.id_for_label }}" class="block text-xs font-black uppercase tracking-widest text-gray-400 mb-2">{{ form.message.label }}</label>
        {{ form.message }}
        {% if form.message.errors %}<p class="mt-1 text-xs text-red-500 font-bold uppercase tracking-wider">{{ form.message.errors|striptags }}</p>{% endif %}
    </div>

    <button type="submit" class="w-full h-14 bg-indigo-600 text-white rounded-2xl font-black text-[12px] uppercase tracking-[0.2em] shadow-lg shadow-indigo-500/20 hover:bg-indigo-700 active:scale-95 transition-all">
        {% translate "Submit RSVP" %}
    </button>
</form>

<script>
    (function() {
        const attendingRadios = document.querySelectorAll('input[name="attending"]');
        const attendingDetailsDiv = document.getElementById('attending_details');
        const attendingYesRadio = document.querySelector('input[name="attending"][value="True"]');

        function toggleAttendingDetails() {
            if (attendingYesRadio && attendingDetailsDiv) {
                attendingDetailsDiv.style.display = attendingYesRadio.checked ? 'block' : 'none';
            }
        }

        attendingRadios.forEach(radio => {
            radio.addEventListener('change', toggleAttendingDetails);
        });

        toggleAttendingDetails();
    })();
</script>

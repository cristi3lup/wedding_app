{% extends "invapp/base.html" %}
{% load i18n %}
{% load allauth %}
{% load socialaccount %}

{% block title %}{% trans "Sign In" %} - InvApp{% endblock %}

{% block content %}
<div class="flex min-h-[80vh] flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <!-- Logo / Title -->
        <h1 class="text-center text-4xl font-serif font-bold tracking-tight text-gray-900 dark:text-white">
            InvApp
        </h1>
        <h2 class="mt-2 text-center text-lg tracking-tight text-gray-600 dark:text-gray-400">
            {% trans "Sign in to manage your events" %}
        </h2>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white dark:bg-gray-800 py-8 px-4 shadow-xl shadow-gray-200/50 dark:shadow-none sm:rounded-xl sm:px-10 border border-gray-100 dark:border-gray-700">

            <!-- Social Login Buttons -->
            <div class="space-y-3">
                <a href="{% provider_login_url 'google' %}" class="flex w-full items-center justify-center gap-3 rounded-md bg-white dark:bg-gray-700 px-3 py-2.5 text-sm font-semibold text-gray-900 dark:text-white shadow-sm ring-1 ring-inset ring-gray-300 dark:ring-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors focus-visible:ring-transparent">
                    <svg class="h-5 w-5" aria-hidden="true" viewBox="0 0 24 24"><path d="M12.0003 4.75C13.7703 4.75 15.3553 5.36002 16.6053 6.54998L19.5403 3.61C17.4803 1.69 14.9303 0.75 12.0003 0.75C7.75033 0.75 4.12033 3.4 2.56033 7.06L5.84033 9.42C6.72033 6.71 9.11033 4.75 12.0003 4.75Z" fill="#EA4335"></path><path d="M12.0003 23.25C14.9303 23.25 17.4803 22.31 19.5403 20.39L16.6003 17.45C15.3553 18.64 13.7703 19.25 12.0003 19.25C9.11033 19.25 6.72033 17.29 5.84033 14.58L2.56033 16.94C4.12033 20.6 7.75033 23.25 12.0003 23.25Z" fill="#34A853"></path><path d="M5.84033 14.58C5.54033 13.73 5.38033 12.87 5.38033 12C5.38033 11.13 5.54033 10.27 5.84033 9.42L2.56033 7.06C1.96033 8.48 1.62033 10.16 1.62033 12C1.62033 13.84 1.96033 15.52 2.56033 16.94L5.84033 14.58Z" fill="#FBBC05"></path><path d="M12.0003 19.25C13.7703 19.25 15.3553 18.64 16.6053 17.45L19.5403 20.39C17.4803 22.31 14.9303 23.25 12.0003 23.25C7.75033 23.25 4.12033 20.6 2.56033 16.94L5.84033 14.58C6.72033 17.29 9.11033 19.25 12.0003 19.25Z" fill="#4285F4"></path></svg>
                    <span class="text-sm font-medium">{% trans "Continue with Google" %}</span>
                </a>
                <a href="{% provider_login_url 'facebook' method='oauth2' %}" class="flex w-full items-center justify-center gap-3 rounded-md bg-[#1877F2] px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-[#166fe5] transition-colors focus-visible:ring-transparent">
                    <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd"></path></svg>
                    <span class="text-sm font-medium">{% trans "Continue with Facebook" %}</span>
                </a>
            </div>

            <div class="relative mt-8">
                <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-200 dark:border-gray-700"></div></div>
                <div class="relative flex justify-center text-sm">
                    <span class="bg-white dark:bg-gray-800 px-2 text-gray-500 dark:text-gray-400">{% trans "Or sign in with email" %}</span>
                </div>
            </div>

            <!-- Email Sign In Form -->
            <form class="mt-6 space-y-6" id="login-form" action="{% url 'account_login' %}" method="POST">
                {% csrf_token %}

                {% if form.errors %}
                    <div class="rounded-md bg-red-50 dark:bg-red-900/20 p-4">
                        <div class="flex">
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800 dark:text-red-200">{% trans "There were errors with your login" %}</h3>
                                <div class="mt-2 text-sm text-red-700 dark:text-red-300">
                                    {{ form.non_field_errors }}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Login Field -->
                <div>
                    <label for="id_login" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
                        {% trans "E-mail" %}
                    </label>
                    <div class="mt-2">
                        {{ form.login }}
                        {% if form.login.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ form.login.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Password Field -->
                <div>
                    <div class="flex items-center justify-between">
                        <label for="id_password" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">
                            {% trans "Password" %}
                        </label>
                        <div class="text-sm">
                            <a href="{% url 'account_reset_password' %}" class="font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400">
                                {% trans "Forgot password?" %}
                            </a>
                        </div>
                    </div>
                    <div class="mt-2">
                        {{ form.password }}
                        {% if form.password.errors %}
                            <p class="mt-2 text-sm text-red-600">{{ form.password.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Remember Me (if enabled in settings) -->
                {% if redirect_field_value %}
                    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% endif %}

                <button type="submit" class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-colors">
                    {% trans "Sign in" %}
                </button>
            </form>

            <p class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400">
                {% trans "Don't have an account?" %}
                <a href="{% url 'account_signup' %}" class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500 dark:text-indigo-400">
                    {% trans "Sign up for free" %}
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // This script automatically applies your custom Tailwind classes to the Allauth form fields
    // so they match the rest of your application without needing to modify backend code.
    document.addEventListener('DOMContentLoaded', function() {
        const inputClasses = "block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600";

        const inputs = document.querySelectorAll('#login-form input[type="text"], #login-form input[type="email"], #login-form input[type="password"]');

        inputs.forEach(input => {
            input.className = inputClasses;
        });
    });
</script>
{% endblock %}
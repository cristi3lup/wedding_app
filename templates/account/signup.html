{% extends "invapp/base.html" %}
{% load i18n %}
{% load account socialaccount %}

{% block title %}{% translate "Sign Up" %} - InvApp{% endblock %}

{% block content %}
<div class="flex min-h-[80vh] flex-col justify-center py-12 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-900">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <h2 class="mt-6 text-center text-3xl font-serif font-bold tracking-tight text-gray-900 dark:text-white">
            {% translate "Create your account" %}
        </h2>
        <p class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
            {% translate "Or" %}
            <a href="{% url 'account_login' %}" class="font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400">
                {% translate "sign in to existing account" %}
            </a>
        </p>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white dark:bg-gray-800 py-8 px-4 shadow-xl shadow-gray-200/50 dark:shadow-none sm:rounded-xl sm:px-10 border border-gray-100 dark:border-gray-700">

            <!-- Errors Display -->
            {% if form.errors %}
                <div class="mb-4 p-4 rounded-md bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
                    <div class="flex">
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800 dark:text-red-200">{% translate "Please correct the errors below:" %}</h3>
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <p class="text-sm text-red-600 dark:text-red-300 mt-1"><strong>{{ field.label }}:</strong> {{ error }}</p>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <p class="text-sm text-red-600 dark:text-red-300 mt-1">{{ error }}</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endif %}

            <form class="space-y-6" id="signup-form" method="POST" action="{% url 'account_signup' %}">
                {% csrf_token %}

                <!-- Email -->
                <div>
                    <label for="id_email" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">{% translate "Email address" %}</label>
                    <div class="mt-2">
                        <input type="email" name="email" id="id_email" autocomplete="email" required
                               class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 dark:bg-gray-700 dark:text-white dark:ring-gray-600"
                               placeholder="you@example.com">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <!-- First Name -->
                    <div>
                        <label for="id_first_name" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">{% translate "First Name" %}</label>
                        <div class="mt-2">
                            <input type="text" name="first_name" id="id_first_name" autocomplete="given-name" required
                                   class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 dark:bg-gray-700 dark:text-white dark:ring-gray-600">
                        </div>
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label for="id_last_name" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">{% translate "Last Name" %}</label>
                        <div class="mt-2">
                            <input type="text" name="last_name" id="id_last_name" autocomplete="family-name" required
                                   class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 dark:bg-gray-700 dark:text-white dark:ring-gray-600">
                        </div>
                    </div>
                </div>

                <!-- Password 1 (Mandatory Display) -->
                <div>
                    <label for="id_password1" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">{% translate "Password" %}</label>
                    <div class="mt-2">
                        <!-- Name must be 'password' not 'password1' usually, but allauth sometimes looks for check_password.
                             Usually allauth standard form uses 'password' for the main field.
                             However, standard django uses password1/2. Let's use standard django names to be safe. -->
                        <input type="password" name="password" id="id_password1" autocomplete="new-password" required
                               class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 dark:bg-gray-700 dark:text-white dark:ring-gray-600">
                    </div>
                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">{% translate "Your password can't be too similar to your other personal information." %}</p>
                </div>

                <!-- Password 2 (Confirm - Mandatory Display) -->
                <!-- Note: Allauth usually handles signup with just one password field in simple configs,
                     but standard best practice is two. If the backend form doesn't expect this,
                     it will just ignore it, but let's try to render the form fields dynamically as backup -->

                 <!-- Dynamic Fallback: If we missed any fields defined in Python, render them here hidden or visible -->
                 {% for field in form %}
                    {% if field.name != 'email' and field.name != 'first_name' and field.name != 'last_name' and field.name != 'password' %}
                        <div class="mt-4">
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium leading-6 text-gray-900 dark:text-gray-100">{{ field.label }}</label>
                            <div class="mt-2">
                                {{ field }}
                            </div>
                            {% if field.help_text %}
                            <p class="mt-1 text-xs text-gray-500">{{ field.help_text }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                 {% endfor %}

                {% if redirect_field_value %}
                    <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% endif %}

                <button type="submit" class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-colors">
                    {% translate "Sign Up" %}
                </button>
            </form>

        </div>
    </div>
</div>
{% endblock %}